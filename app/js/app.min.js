"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("table"),t=document.getElementsByTagName("body").item(0),n=document.getElementsByTagName("header").item(0),r=document.getElementsByTagName("main").item(0),a=document.getElementById("container"),s=document.getElementById("delete"),o=document.getElementById("clear"),i=document.getElementById("add"),d=document.getElementById("host"),l=document.getElementById("file"),u=document.getElementById("download"),c=[],f=0,m=function e(t){return _classCallCheck(this,e),document.createElement(t)};_defineProperty(m,"setClass",(function(e,t){e.setAttribute("class",t)})),_defineProperty(m,"setId",(function(e,t){e.setAttribute("id",t)})),_defineProperty(m,"setPlaceholder",(function(e,t){e.setAttribute("placeholder",t)}));var h=new function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"storage",{}),_defineProperty(this,"getItem",(function(e){return window.localStorage.getItem(e)})),_defineProperty(this,"names",{}),_defineProperty(this,"phones",{}),_defineProperty(this,"addresses",{}),_defineProperty(this,"setNames",(function(e){t.names=e})),_defineProperty(this,"setPhones",(function(e){t.phones=e})),_defineProperty(this,"setAddresses",(function(e){t.addresses=e})),_defineProperty(this,"refreshStorage",(function(){t.storage.setItem("names",JSON.stringify(t.names)),t.storage.setItem("phones",JSON.stringify(t.phones)),t.storage.setItem("addresses",JSON.stringify(t.addresses))})),_defineProperty(this,"updateStorage",(function(e,n,r){var a={},s={},o="",i="";switch(n){case"full_name":s=t.phones,o=E(r),a=t.names,i=A(r);break;case"address":s=t.names,o=C(r),a=t.addresses,i=E(r);break;case"phone":s=t.addresses,o=A(r),i=C(r),a=t.phones}for(var d in s[o]=e,a)a[d]===i&&(delete a[d],a[e]=i);t.refreshStorage()})),_defineProperty(this,"isUnique",(function(e,n){switch(e){case"full_name":return!Boolean(t.names[n]);case"phone":return!Boolean(t.phones[n]);case"address":return!Boolean(t.addresses[n])}})),_defineProperty(this,"updateNameByPhone",(function(e,n){t.phones[e]=n})),_defineProperty(this,"updateAddressByName",(function(e,n){t.names[e]=n})),_defineProperty(this,"updatePhoneByAddress",(function(e,n){t.addresses[e]=n})),_defineProperty(this,"addNewRecord",(function(e,t,n){h.updateNameByPhone(t,e),h.updateAddressByName(e,n),h.updatePhoneByAddress(n,t),h.refreshStorage()})),_defineProperty(this,"deleteData",(function(e){delete t.phones[E(e)],delete t.addresses[A(e)],delete t.names[C(e)]})),_defineProperty(this,"clean",(function(){window.localStorage.clear(),t.setNames({}),t.setPhones({}),t.setAddresses({}),t.refreshStorage()})),_defineProperty(this,"getData",(function(){var e=[];for(var n in t.addresses){var r=t.addresses[n],a=t.phones[r];e.push({full_name:a,phone:r,address:n})}return JSON.stringify(e)})),this.storage=window.localStorage},p=function(t){c=[];for(var n=e.getElementsByTagName("tr"),r=0;r<n.length;r++){var a=n.item(r);a.removeAttribute("style"),a.removeAttribute("selected")}},g=function(e,a){t.removeChild(a),r.style.filter="",n.style.filter=""},y=function(){if(1===a.getElementsByTagName("table").length){a.removeChild(e);var t=document.createElement("div"),n=document.createElement("h2");t.appendChild(n),n.innerText="There`s no info... Add some!",a.appendChild(t),s.setAttribute("disabled",""),o.setAttribute("disabled","")}},v=function(){0!==a.getElementsByTagName("div").length&&(a.removeChild(a.getElementsByTagName("div").item(0)),a.appendChild(e))},b=function(e,t){return e.getElementsByTagName("td")[t]},C=function(e){return b(e,0).innerText},A=function(e){return b(e,2).innerText},E=function(e){return b(e,1).innerText},_=function(t,n,r){var a=t.target,s=function(t){return e.getElementsByTagName("tr")[parseInt(t)+1]}(r),o=b(s,n),i=a.value,d=o.getAttribute("key");i.length>0&&(h.updateStorage(i,d,s),o.removeChild(a),o.innerText=i)},B=function(e){0===c.length?(s.setAttribute("disabled",""),o.setAttribute("disabled","")):(s.removeAttribute("disabled"),o.removeAttribute("disabled"))},N=function(t){var n=document.createElement("tr");n.onclick=function(e){!function(e){var t=e.currentTarget,n=t.getAttribute("selected"),r=t.style,a=t.getElementsByTagName("td")[0].getAttribute("vertIndex");null===n?(r.backgroundColor="#89099c",r.color="white",t.setAttribute("selected",""),c.push(a)):(r.backgroundColor="transparent",r.color="black",t.removeAttribute("selected"),c=c.filter((function(e){return e!==a}))),B()}(e)},Object.keys(t).forEach((function(e,r){var a=document.createElement("td");a.innerText=t[e],a.setAttribute("horIndex",r),a.setAttribute("vertIndex",f),a.setAttribute("key",e),a.ondblclick=function(e){!function(e){p();var t=e.target,n=t.getAttribute("vertIndex"),r=t.getAttribute("horIndex"),a=document.createElement("input");a.value=t.innerText,a.onblur=function(e){_(e,r,n)},t.innerText="",t.appendChild(a),a.focus()}(e)},n.appendChild(a)})),e.appendChild(n),f++},T=function(){v();var e=JSON.parse(h.getItem("names"));null===e&&(e={}),h.setNames(e);var t=JSON.parse(h.getItem("phones"));null===t&&(t={}),h.setPhones(t);var n=JSON.parse(h.getItem("addresses"));for(var r in null===n&&(n={}),h.setAddresses(n),n){var a=n[r],s=t[a];N({full_name:s,phone:a,address:r})}0!==f&&0!==h.length||y()},P=function(t){t.preventDefault();var n,r=e.getElementsByTagName("tr");if(1===r.length)y();else if(r.length>1)for(var a=1;a<r.length;a++)e.removeChild(r.item(a));v(),(n=new XMLHttpRequest).onload=function(e){e.currentTarget.response.forEach((function(e){var t=e.address,n=e.phone,r=e.full_name;h.addNewRecord(r,n,t)}))},n.open("GET","https://whatruska.github.io/Bars_Group_Test/app/lpu.json"),n.responseType="json",n.send(),h.refreshStorage(),window.location.reload()};B(),d.onclick=P,i.onclick=function(e){var a=new m("div");m.setClass(a,"modal");var s=new m("form"),o=new m("span");m.setClass(o,"heading"),o.innerText="Add new info",s.appendChild(o);var i=function(e,t){var n=new m("input");return m.setId(n,e),m.setPlaceholder(n,t),n.setAttribute("autocomplete","off"),s.appendChild(n),n};i("full_name","Name"),i("phone","Phone").setAttribute("type","phone"),i("address","Address"),s.focus(),s.onmouseleave=function(e){g(0,a)};var d=new m("button");d.innerText="Add",d.onclick=function(e){return function(e,t){e.preventDefault();for(var n=!0,r=t.getElementsByTagName("input"),a={},s=0;s<r.length;s++){var o=r.item(s),i=o.getAttribute("id"),d=o.value,l=new m("span");m.setClass(l,"error");var u=t.getElementsByTagName("span");if(o.style.borderColor="black",u.length>1&&t.removeChild(u.item(u.length-1)),0===d.length){n=!1,l.innerText="Empty field",o.style.borderBottomColor="red",t.appendChild(l);break}if(!h.isUnique(i,d)){n=!1,l.innerText=i.charAt(0).toUpperCase()+i.substring(1)+" is not unique",o.style.borderBottomColor="red",t.appendChild(l);break}a[i]=d}n&&(0===h.getItem("addresses").length&&v(),h.addNewRecord(a.full_name,a.phone,a.address),h.refreshStorage(),N({full_name:a.full_name,phone:a.phone,address:a.address}),g(0,t))}(e,a)},s.appendChild(d),a.appendChild(s),r.style.transition="0.7s all linear",r.style.filter="blur(10px)",n.style.transition="0.7s all linear",n.style.filter="blur(10px)",t.appendChild(a)},o.onclick=function(e){p(),B()},s.onclick=function(t){c=[];for(var n=[],r=e.getElementsByTagName("tr"),a=0;a<r.length;a++){var s=r.item(a);null!==s.getAttribute("selected")&&(n.push(s),h.deleteData(s),h.refreshStorage())}n.forEach((function(t){e.removeChild(t)})),1===r.length&&y(),B()},l.onchange=function(t){var n=t.target.files[0],r=new FileReader;r.onload=function(t){var n=t.target.result,r=JSON.parse(n);h.clean(),r.forEach((function(e){var t=e.full_name,n=e.phone,r=e.address;h.addNewRecord(t,n,r)})),function(){for(var t=e.getElementsByTagName("tr"),n=t.length-1;n>0;n--)e.removeChild(t.item(n))}(),T()},r.onerror=function(e){console.error("Файл не может быть прочитан! код "+e.target.error.code)},r.readAsText(n)},u.onclick=function(e){var t,n,r;t="lpu.json",n=document.createElement("a"),r=h.getData(),n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},T()}));