document.addEventListener("DOMContentLoaded",(function(){let e=window.localStorage,t=document.getElementById("table"),n=document.getElementById("delete"),l=document.getElementById("clear"),r=document.getElementById("add"),o=document.getElementsByTagName("body").item(0),a=document.getElementsByTagName("header").item(0),d=document.getElementsByTagName("main").item(0),s=document.getElementById("container"),i=[],m={},c={},u={},p=0,g=()=>{e.setItem("names",JSON.stringify(m)),e.setItem("phones",JSON.stringify(c)),e.setItem("addresses",JSON.stringify(u))},h=(e,t)=>{e.setAttribute("class",t)},b=(e,t)=>{e.setAttribute("id",t)},f=(e,t)=>{e.setAttribute("placeholder",t)},y=e=>{i=[];let n=t.getElementsByTagName("tr");for(let e=0;e<n.length;e++){let t=n.item(e);t.removeAttribute("style"),t.removeAttribute("selected")}};l.onclick=e=>{y()},n.onclick=e=>{i=[];let n=[],l=t.getElementsByTagName("tr");for(let e=0;e<l.length;e++){let t=l.item(e);null!==t.getAttribute("selected")&&(n.push(t),delete c[N(t)],delete u[x(t)],delete m[k(t)],g())}n.forEach(e=>{t.removeChild(e)}),1===l.length&&C()};let E=(e,t)=>{o.removeChild(t),d.style.filter="",a.style.filter=""},A=(e,t)=>{switch(console.log(e),console.log(t),e){case"full_name":return console.log(Boolean(m[t])),!Boolean(m[t]);case"phone":return console.log(Boolean(c[t])),!Boolean(c[t]);case"address":return console.log(Boolean(u[t])),!Boolean(u[t])}};r.onclick=e=>{let t=document.createElement("div");h(t,"modal");let n=document.createElement("form"),l=document.createElement("span");h(l,"heading"),l.innerText="Add new info",n.appendChild(l);let r=document.createElement("input");b(r,"full_name"),f(r,"Name"),r.setAttribute("autocomplete","off"),n.appendChild(r),r=document.createElement("input"),b(r,"phone"),r.setAttribute("type","phone"),f(r,"Phone"),r.setAttribute("autocomplete","off"),n.appendChild(r),r=document.createElement("input"),b(r,"address"),f(r,"Address"),r.setAttribute("autocomplete","off"),n.appendChild(r),n.focus(),n.onmouseleave=e=>{E(0,t)};let s=document.createElement("button");s.innerText="Add",s.onclick=e=>((e,t)=>{e.preventDefault();let n=!0,l=t.getElementsByTagName("input"),r={};for(let e=0;e<l.length;e++){let o=l.item(e),a=o.getAttribute("id"),d=o.value,s=document.createElement("span"),i=t.getElementsByTagName("span");if(o.style.borderColor="black",i.length>1&&t.removeChild(i.item(i.length-1)),0===d.length){n=!1,h(s,"error"),s.innerText="Empty field",o.style.borderBottomColor="red",t.appendChild(s);break}if(!A(a,d)){n=!1,h(s,"error"),s.innerText=a.charAt(0).toUpperCase()+a.substring(1)+" is not unique",o.style.borderBottomColor="red",t.appendChild(s);break}r[a]=d}n&&(0===u.length&&T(),c[r.phone]=r.full_name,m[r.full_name]=r.address,u[r.address]=r.phone,g(),O({full_name:r.full_name,phone:r.phone,address:r.address}),E(0,t))})(e,t),n.appendChild(s),t.appendChild(n),d.style.transition="0.7s all linear",d.style.filter="blur(10px)",a.style.transition="0.7s all linear",a.style.filter="blur(10px)",o.appendChild(t)};let C=()=>{s.removeChild(t);let e=document.createElement("div"),r=document.createElement("h2");e.appendChild(r),r.innerText="There`s no info... Add some!",s.appendChild(e),n.setAttribute("disabled",""),l.setAttribute("disabled","")},T=()=>{s.removeChild(s.getElementsByTagName("div").item(0)),s.appendChild(t)},B=e=>t.getElementsByTagName("tr")[parseInt(e)+1],v=(e,t)=>e.getElementsByTagName("td")[t],k=e=>v(e,0).innerText,x=e=>v(e,2).innerText,N=e=>v(e,1).innerText,I=(e,t,n)=>{let l=e.target,r=B(n),o=v(r,t),a=l.value,d=o.getAttribute("key");a.length>0&&(((e,t,n)=>{switch(t){case"full_name":{let t=N(n);c[t]=e;break}case"address":{let t=k(n);m[t]=e;break}case"phone":{let t=x(n);u[t]=e;break}}g()})(a,d,r),o.removeChild(l),o.innerText=a)},O=e=>{let n=document.createElement("tr");n.onclick=e=>{(e=>{let t=e.currentTarget,n=t.getAttribute("selected"),l=t.style,r=t.getElementsByTagName("td")[0].getAttribute("vertIndex");null===n?(l.backgroundColor="#89099c",l.color="white",t.setAttribute("selected",""),i.push(r)):(l.backgroundColor="transparent",l.color="black",t.removeAttribute("selected"),i=i.filter(e=>e!==r))})(e)},Object.keys(e).forEach((t,l)=>{let r=document.createElement("td");r.innerText=e[t],r.setAttribute("horIndex",l),r.setAttribute("vertIndex",p),r.setAttribute("key",t),r.ondblclick=e=>{(e=>{y();let t=e.target,n=t.getAttribute("vertIndex"),l=t.getAttribute("horIndex"),r=document.createElement("input");r.value=t.innerText,r.onblur=e=>{I(e,l,n)},t.innerText="",t.appendChild(r),r.focus()})(e)},n.appendChild(r)}),t.appendChild(n),p++};(()=>{m=JSON.parse(e.getItem("names")),c=JSON.parse(e.getItem("phones")),u=JSON.parse(e.getItem("addresses"));let t=Object.keys(u);for(let e=0;e<t.length;e++){let n=t[e],l=u[n],r=c[l];O({full_name:r,phone:l,address:n})}0===p&&C()})()}));