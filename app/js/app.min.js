document.addEventListener("DOMContentLoaded",(function(){let e=window.localStorage,t=document.getElementById("table"),l=document.getElementById("delete"),n=document.getElementById("clear"),r=document.getElementById("add"),d=document.getElementsByTagName("body").item(0),a=document.getElementsByTagName("header").item(0),o=document.getElementsByTagName("main").item(0),i=document.getElementById("container"),s=[],m={},c={},u={},p=0,g=()=>{e.setItem("names",JSON.stringify(m)),e.setItem("phones",JSON.stringify(c)),e.setItem("addresses",JSON.stringify(u))},h=(e,t)=>{e.setAttribute("class",t)},b=(e,t)=>{e.setAttribute("id",t)},f=(e,t)=>{e.setAttribute("placeholder",t)},y=e=>{s=[];let l=t.getElementsByTagName("tr");for(let e=0;e<l.length;e++){let t=l.item(e);t.removeAttribute("style"),t.removeAttribute("selected")}};n.onclick=e=>{y()},l.onclick=e=>{s=[];let l=[],n=t.getElementsByTagName("tr");for(let e=0;e<n.length;e++){let t=n.item(e);null!==t.getAttribute("selected")&&(console.log(e),l.push(t),delete c[x(t)],delete u[k(t)],delete m[I(t)],g())}l.forEach(e=>{t.removeChild(e)}),1===n.length&&A()};let E=(e,t)=>{d.removeChild(t),o.style.filter="",a.style.filter=""};r.onclick=t=>{let l=document.createElement("div");h(l,"modal");let n=document.createElement("form"),r=document.createElement("span");h(r,"heading"),r.innerText="Add new info",n.appendChild(r);let i=document.createElement("input");b(i,"full_name"),f(i,"Name"),i.setAttribute("autocomplete","off"),n.appendChild(i),i=document.createElement("input"),b(i,"phone"),i.setAttribute("type","phone"),f(i,"Phone"),i.setAttribute("autocomplete","off"),n.appendChild(i),i=document.createElement("input"),b(i,"address"),f(i,"Address"),i.setAttribute("autocomplete","off"),n.appendChild(i),n.focus(),n.onmouseleave=e=>{E(0,l)};let s=document.createElement("button");s.innerText="Add",s.onclick=t=>((t,l)=>{t.preventDefault();let n=!0,r=l.getElementsByTagName("input"),d={};for(let t=0;t<r.length;t++){let a=r.item(t),o=a.getAttribute("id"),i=a.value,s=document.createElement("span"),m=l.getElementsByTagName("span");if(a.style.borderColor="black",console.log(m.length),m.length>1&&l.removeChild(m.item(m.length-1)),0===i.length){n=!1,h(s,"error"),s.innerText="Empty field",a.style.borderBottomColor="red",l.appendChild(s);break}if(null!==e.getItem(i)){n=!1,h(s,"error"),s.innerText=o.charAt(0).toUpperCase()+o.substring(1)+" is not unique",a.style.borderBottomColor="red",l.appendChild(s);break}d[o]=i,console.log(d)}n&&(e.setItem(d.phone,d.full_name),e.setItem(d.full_name,d.address),e.setItem(d.address,d.phone),C(),N({full_name:d.full_name,phone:d.phone,address:d.address}),E(0,l))})(t,l),n.appendChild(s),l.appendChild(n),o.style.transition="0.7s all linear",o.style.filter="blur(10px)",a.style.transition="0.7s all linear",a.style.filter="blur(10px)",d.appendChild(l)};let A=()=>{i.removeChild(t);let e=document.createElement("div"),r=document.createElement("h2");e.appendChild(r),r.innerText="There`s no info... Add some!",i.appendChild(e),l.setAttribute("disabled",""),n.setAttribute("disabled","")},C=()=>{i.removeChild(i.getElementsByTagName("div").item(0)),i.appendChild(t)},T=e=>t.getElementsByTagName("tr")[parseInt(e)+1],v=(e,t)=>e.getElementsByTagName("td")[t],I=e=>v(e,0).innerText,k=e=>v(e,2).innerText,x=e=>v(e,1).innerText,B=(e,t,l)=>{let n=e.target,r=T(l),d=v(r,t),a=n.value,o=d.getAttribute("key");a.length>0&&(((e,t,l)=>{switch(t){case"full_name":{let t=x(l);c[t]=e;break}case"address":{let t=I(l);m[t]=e;break}case"phone":{let t=k(l);u[t]=e;break}}g()})(a,o,r),d.removeChild(n),d.innerText=a)},N=e=>{let l=document.createElement("tr");l.onclick=e=>{(e=>{let t=e.currentTarget,l=t.getAttribute("selected"),n=t.style,r=t.getElementsByTagName("td")[0].getAttribute("vertIndex");null===l?(n.backgroundColor="#89099c",n.color="white",t.setAttribute("selected",""),s.push(r)):(n.backgroundColor="transparent",n.color="black",t.removeAttribute("selected"),s=s.filter(e=>e!==r))})(e)},Object.keys(e).forEach((t,n)=>{let r=document.createElement("td");r.innerText=e[t],r.setAttribute("horIndex",n),r.setAttribute("vertIndex",p),r.setAttribute("key",t),r.ondblclick=e=>{(e=>{y();let t=e.target,l=t.getAttribute("vertIndex"),n=t.getAttribute("horIndex"),r=document.createElement("input");r.value=t.innerText,r.onblur=e=>{B(e,n,l)},t.innerText="",t.appendChild(r),r.focus()})(e)},l.appendChild(r)}),t.appendChild(l),p++};(()=>{m=JSON.parse(e.getItem("names")),c=JSON.parse(e.getItem("phones")),u=JSON.parse(e.getItem("addresses"));let t=Object.keys(u);for(let e=0;e<t.length;e++){let l=t[e],n=u[l],r=c[n];N({full_name:r,phone:n,address:l})}0===p&&A()})()}));