document.addEventListener("DOMContentLoaded",(function(){let e=window.localStorage,t=document.getElementById("table"),l=document.getElementById("delete"),n=document.getElementById("clear"),r=document.getElementById("add"),a=document.getElementById("upload"),d=document.getElementsByTagName("body").item(0),o=document.getElementsByTagName("header").item(0),i=document.getElementsByTagName("main").item(0),s=document.getElementById("container"),m=[],u={},c={},p={},h=0,g=()=>{e.setItem("names",JSON.stringify(u)),e.setItem("phones",JSON.stringify(c)),e.setItem("addresses",JSON.stringify(p))},b=(e,t)=>{e.setAttribute("class",t)},f=(e,t)=>{e.setAttribute("id",t)},y=(e,t)=>{e.setAttribute("placeholder",t)},E=e=>{m=[];let l=t.getElementsByTagName("tr");for(let e=0;e<l.length;e++){let t=l.item(e);t.removeAttribute("style"),t.removeAttribute("selected")}};n.onclick=e=>{E()},l.onclick=e=>{m=[];let l=[],n=t.getElementsByTagName("tr");for(let e=0;e<n.length;e++){let t=n.item(e);null!==t.getAttribute("selected")&&(l.push(t),delete c[I(t)],delete p[x(t)],delete u[N(t)],g())}l.forEach(e=>{t.removeChild(e)}),1===n.length&&A()};let C=(e,t)=>{d.removeChild(t),i.style.filter="",o.style.filter=""},T=(e,t)=>{switch(e){case"full_name":return!Boolean(u[t]);case"phone":return!Boolean(c[t]);case"address":return!Boolean(p[t])}};r.onclick=e=>{let t=document.createElement("div");b(t,"modal");let l=document.createElement("form"),n=document.createElement("span");b(n,"heading"),n.innerText="Add new info",l.appendChild(n);let r=document.createElement("input");f(r,"full_name"),y(r,"Name"),r.setAttribute("autocomplete","off"),l.appendChild(r),r=document.createElement("input"),f(r,"phone"),r.setAttribute("type","phone"),y(r,"Phone"),r.setAttribute("autocomplete","off"),l.appendChild(r),r=document.createElement("input"),f(r,"address"),y(r,"Address"),r.setAttribute("autocomplete","off"),l.appendChild(r),l.focus(),l.onmouseleave=e=>{C(0,t)};let a=document.createElement("button");a.innerText="Add",a.onclick=e=>((e,t)=>{e.preventDefault();let l=!0,n=t.getElementsByTagName("input"),r={};for(let e=0;e<n.length;e++){let a=n.item(e),d=a.getAttribute("id"),o=a.value,i=document.createElement("span"),s=t.getElementsByTagName("span");if(a.style.borderColor="black",s.length>1&&t.removeChild(s.item(s.length-1)),0===o.length){l=!1,b(i,"error"),i.innerText="Empty field",a.style.borderBottomColor="red",t.appendChild(i);break}if(!T(d,o)){l=!1,b(i,"error"),i.innerText=d.charAt(0).toUpperCase()+d.substring(1)+" is not unique",a.style.borderBottomColor="red",t.appendChild(i);break}r[d]=o}l&&(0===p.length&&B(),c[r.phone]=r.full_name,u[r.full_name]=r.address,p[r.address]=r.phone,g(),w({full_name:r.full_name,phone:r.phone,address:r.address}),C(0,t))})(e,t),l.appendChild(a),t.appendChild(l),i.style.transition="0.7s all linear",i.style.filter="blur(10px)",o.style.transition="0.7s all linear",o.style.filter="blur(10px)",d.appendChild(t)};let A=()=>{if(1===s.getElementsByTagName("table").length){s.removeChild(t);let e=document.createElement("div"),r=document.createElement("h2");e.appendChild(r),r.innerText="There`s no info... Add some!",s.appendChild(e),l.setAttribute("disabled",""),n.setAttribute("disabled","")}},B=()=>{0!==s.getElementsByTagName("div").length&&(s.removeChild(s.getElementsByTagName("div").item(0)),s.appendChild(t))},v=e=>t.getElementsByTagName("tr")[parseInt(e)+1],k=(e,t)=>e.getElementsByTagName("td")[t],N=e=>k(e,0).innerText,x=e=>k(e,2).innerText,I=e=>k(e,1).innerText,_=(e,t,l)=>{let n=e.target,r=v(l),a=k(r,t),d=n.value,o=a.getAttribute("key");d.length>0&&(((e,t,l)=>{switch(t){case"full_name":{let t=I(l);c[t]=e;break}case"address":{let t=N(l);u[t]=e;break}case"phone":{let t=x(l);p[t]=e;break}}g()})(d,o,r),a.removeChild(n),a.innerText=d)},w=e=>{let l=document.createElement("tr");l.onclick=e=>{(e=>{let t=e.currentTarget,l=t.getAttribute("selected"),n=t.style,r=t.getElementsByTagName("td")[0].getAttribute("vertIndex");null===l?(n.backgroundColor="#89099c",n.color="white",t.setAttribute("selected",""),m.push(r)):(n.backgroundColor="transparent",n.color="black",t.removeAttribute("selected"),m=m.filter(e=>e!==r))})(e)},Object.keys(e).forEach((t,n)=>{let r=document.createElement("td");r.innerText=e[t],r.setAttribute("horIndex",n),r.setAttribute("vertIndex",h),r.setAttribute("key",t),r.ondblclick=e=>{(e=>{E();let t=e.target,l=t.getAttribute("vertIndex"),n=t.getAttribute("horIndex"),r=document.createElement("input");r.value=t.innerText,r.onblur=e=>{_(e,n,l)},t.innerText="",t.appendChild(r),r.focus()})(e)},l.appendChild(r)}),t.appendChild(l),h++};a.onclick=e=>{e.preventDefault();let l=t.getElementsByTagName("tr");if(1===l.length)A();else if(l.length>1)for(let e=1;e<l.length;e++)t.removeChild(l.item(e));B(),fetch("https://whatruska.github.io/Bars_Group_Test/app/lpu.json").then(e=>e.json()).then(e=>{e.forEach(e=>{let t=e.address,l=e.phone,n=e.full_name;w(e),c[l]=n,u[n]=t,p[t]=l}),g(),window.location.reload()})},(()=>{B(),u=JSON.parse(e.getItem("names")),null===u&&(u={}),c=JSON.parse(e.getItem("phones")),null===c&&(c={}),p=JSON.parse(e.getItem("addresses")),null===p&&(p={});let t=Object.keys(p);for(let e=0;e<t.length;e++){let l=t[e],n=p[l],r=c[n];w({full_name:r,phone:n,address:l})}0!==h&&0!==e.length||A()})()}));