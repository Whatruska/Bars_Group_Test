"use strict";document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("table"),t=e.getElementsByClassName("table-row"),s=document.getElementsByTagName("body").item(0),n=document.getElementsByTagName("header").item(0),l=document.getElementsByTagName("main").item(0),r=document.getElementById("container"),d=document.getElementById("delete"),o=document.getElementById("clear"),a=document.getElementById("add"),i=document.getElementById("host"),h=document.getElementById("file"),m=document.getElementById("download"),u=[],c=0;class g{constructor(e){return document.createElement(e)}static setClass=(e,t)=>{e.setAttribute("class",t)};static setId=(e,t)=>{e.setAttribute("id",t)};static setPlaceholder=(e,t)=>{e.setAttribute("placeholder",t)}}let p="#52A8B6",b="#F27171",f="#5585B5",y="#1D2734",C="#F4F6F9",A="#1D2734",E=new class{storage={};constructor(){this.storage=window.localStorage}getItem=e=>window.localStorage.getItem(e);names={};phones={};addresses={};setNames=e=>{this.names=e};setPhones=e=>{this.phones=e};setAddresses=e=>{this.addresses=e};refreshStorage=()=>{this.storage.setItem("names",JSON.stringify(this.names)),this.storage.setItem("phones",JSON.stringify(this.phones)),this.storage.setItem("addresses",JSON.stringify(this.addresses))};updateStorage=(e,t,s)=>{let n={},l={},r="",d="";switch(t){case"full_name":l=this.phones,r=x(s),n=this.names,d=k(s);break;case"address":l=this.names,r=I(s),n=this.addresses,d=x(s);break;case"phone":l=this.addresses,r=k(s),d=I(s),n=this.phones}l[r]=e;for(let t in n)n[t]===d&&(delete n[t],n[e]=d);this.refreshStorage()};isUnique=(e,t)=>{switch(e){case"full_name":return!Boolean(this.names[t]);case"phone":return!Boolean(this.phones[t]);case"address":return!Boolean(this.addresses[t])}};updateNameByPhone=(e,t)=>{this.phones[e]=t};updateAddressByName=(e,t)=>{this.names[e]=t};updatePhoneByAddress=(e,t)=>{this.addresses[e]=t};addNewRecord=(e,t,s)=>{E.updateNameByPhone(t,e),E.updateAddressByName(e,s),E.updatePhoneByAddress(s,t),E.refreshStorage()};deleteData=e=>{delete this.phones[x(e)],delete this.addresses[k(e)],delete this.names[I(e)]};clean=()=>{window.localStorage.clear(),this.setNames({}),this.setPhones({}),this.setAddresses({}),this.refreshStorage()};getData=()=>{let e=[];for(let t in this.addresses){let s=this.addresses[t],n=this.phones[s];e.push({full_name:n,phone:s,address:t})}return JSON.stringify(e)}},B=e=>{u=[];for(let e=0;e<t.length;e++){let s=t.item(e);s.removeAttribute("style"),s.removeAttribute("selected");let n=[...t].indexOf(s);n%2==0&&0!==n&&(s.style.backgroundColor=p)}},v=(e,t)=>{s.removeChild(t),l.style.filter="",n.style.filter=""},N=()=>{if(5===r.getElementsByTagName("div").length){r.removeChild(e);let t=document.createElement("div");g.setId(t,"slide"),t.style.color=y;let s=document.createElement("h2");t.appendChild(s),s.innerText="There`s no info... Add some!",r.appendChild(t),d.setAttribute("disabled",""),o.setAttribute("disabled","")}},w=()=>{let t=document.getElementById("slide");t&&(r.removeChild(t),r.appendChild(e))},T=(e,t)=>e.getElementsByTagName("div")[t],I=e=>T(e,0).innerText,k=e=>T(e,2).innerText,x=e=>T(e,1).innerText,S=(e,s,n)=>{let l=e.target,r=(e=>t[parseInt(e)+1])(n),d=T(r,s),o=l.value,a=d.getAttribute("key");o.length>0&&(E.updateStorage(o,a,r),d.removeChild(l),d.innerText=o),O()},O=e=>{0===u.length?(d.setAttribute("disabled",""),o.setAttribute("disabled","")):(d.removeAttribute("disabled"),o.removeAttribute("disabled"))},_=s=>{let n=document.createElement("div");g.setClass(n,"row table-row"),n.onclick=e=>{(e=>{let s=e.currentTarget,n=s.getAttribute("selected"),l=s.style;l.color=y;let r=s.getElementsByTagName("div")[0].getAttribute("vertIndex");if(null===n)l.backgroundColor=f,s.setAttribute("selected",""),u.push(r);else{l.backgroundColor=C,[...t].indexOf(s)%2==0&&(l.backgroundColor=p),s.removeAttribute("selected"),u=u.filter(e=>e!==r)}O()})(e)},Object.keys(s).forEach((e,t)=>{let l=document.createElement("div");g.setClass(l,"table-item"),l.innerText=s[e],l.setAttribute("horIndex",t),l.setAttribute("vertIndex",c),l.setAttribute("key",e),l.ondblclick=e=>{(e=>{B(),O();let t=e.target,s=t.getAttribute("vertIndex"),n=t.getAttribute("horIndex"),l=document.createElement("input"),r=l.style;l.value=t.innerText,r.backgroundColor=C,r.borderBottomColor=y,r.color=y,s%2!=0&&(r.backgroundColor=p),l.onblur=e=>{S(e,n,s)},t.innerText="",t.appendChild(l),l.focus()})(e)},n.appendChild(l)}),e.appendChild(n),n.style.backgroundColor=C,t.length%2!=0&&(n.style.backgroundColor=p),c++},P=()=>{w();let e=JSON.parse(E.getItem("names"));null===e&&(e={}),E.setNames(e);let t=JSON.parse(E.getItem("phones"));null===t&&(t={}),E.setPhones(t);let s=JSON.parse(E.getItem("addresses"));null===s&&(s={}),E.setAddresses(s);for(let e in s){let n=s[e],l=t[n];_({full_name:l,phone:n,address:e})}0!==c&&0!==E.length||N()},D=t=>{t.preventDefault();let s=e.getElementsByTagName("tr");if(1===s.length)N();else if(s.length>1)for(let t=1;t<s.length;t++)e.removeChild(s.item(t));w(),(()=>{let e=new XMLHttpRequest;e.onload=function(e){e.currentTarget.response.forEach(e=>{let t=e.address,s=e.phone,n=e.full_name;E.addNewRecord(n,s,t)})},e.open("GET","https://whatruska.github.io/Bars_Group_Test/app/lpu.json"),e.responseType="json",e.send(),E.refreshStorage()})(),window.location.reload()};O(),i.onclick=D,a.onclick=e=>{let t=new g("div");g.setClass(t,"modal");let r=new g("form"),d=new g("span");g.setClass(d,"heading"),d.innerText="Add new info",r.appendChild(d);let o=(e,t)=>{let s=new g("input");return g.setId(s,e),g.setPlaceholder(s,t),s.setAttribute("autocomplete","off"),r.appendChild(s),s};o("full_name","Name"),o("phone","Phone").setAttribute("type","phone"),o("address","Address"),r.focus(),r.onmouseleave=e=>{v(0,t)};let a=new g("button");a.innerText="Add",a.onclick=e=>((e,t)=>{e.preventDefault();let s=!0,n=t.getElementsByTagName("input"),l={};for(let e=0;e<n.length;e++){let r=n.item(e),d=r.getAttribute("id"),o=r.value,a=new g("span");g.setClass(a,"error");let i=t.getElementsByTagName("span");if(r.style.borderColor=p,i.length>1&&t.removeChild(i.item(i.length-1)),0===o.length){s=!1,a.innerText="Empty field",r.style.borderBottomColor=b,t.appendChild(a);break}if(!E.isUnique(d,o)){s=!1,a.innerText=d.charAt(0).toUpperCase()+d.substring(1)+" is not unique",r.style.borderBottomColor=b,t.appendChild(a);break}l[d]=o}s&&(w(),E.addNewRecord(l.full_name,l.phone,l.address),E.refreshStorage(),_({full_name:l.full_name,phone:l.phone,address:l.address}),v(0,t))})(e,t),r.appendChild(a),t.appendChild(r),l.style.transition="0.7s all linear",l.style.filter="blur(10px)",n.style.transition="0.7s all linear",n.style.filter="blur(10px)",s.appendChild(t)},o.onclick=e=>{B(),O(e)},d.onclick=s=>{u=[];let n=[],l=[...t];for(let e=0;e<l.length;e++){let t=l[e];null!==t.getAttribute("selected")&&(n.push(t),E.deleteData(t),E.refreshStorage())}n.forEach(t=>{e.removeChild(t)}),l=[...t],1===l.length&&N(),[...t].forEach((e,t)=>{[...e.getElementsByTagName("div")].forEach(e=>{e.setAttribute("vertIndex",t-1)}),e.color=y,e.style.backgroundColor=0===t?A:t%2==0?p:C}),O(s)},h.onchange=s=>{let n=s.target.files[0],l=new FileReader;l.onload=function(s){let n=s.target.result,l=JSON.parse(n);E.clean(),l.forEach(e=>{let t=e.full_name,s=e.phone,n=e.address;E.addNewRecord(t,s,n)}),(()=>{for(let s=t.length-1;s>0;s--)e.removeChild(t.item(s))})(),P()},l.onerror=function(e){console.error("Файл не может быть прочитан! код "+e.target.error.code)},l.readAsText(n)},m.onclick=e=>{(e=>{let t=document.createElement("a"),s=E.getData();t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s)),t.setAttribute("download",e),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)})("lpu.json")},P()}));