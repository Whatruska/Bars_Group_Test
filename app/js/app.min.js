document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("table"),t=document.getElementById("delete"),n=document.getElementById("clear"),s=document.getElementById("add"),l=document.getElementById("upload"),r=document.getElementsByTagName("body").item(0),a=document.getElementsByTagName("header").item(0),d=document.getElementsByTagName("main").item(0),o=document.getElementById("container"),i=[],m=0,h=new class{storage={};constructor(){this.storage=window.localStorage}getItem=e=>window.localStorage.getItem(e);names={};phones={};addresses={};setNames=e=>{this.names=e};setPhones=e=>{this.phones=e};setAddresses=e=>{this.addresses=e};refreshStorage=()=>{this.storage.setItem("names",JSON.stringify(this.names)),this.storage.setItem("phones",JSON.stringify(this.phones)),this.storage.setItem("addresses",JSON.stringify(this.addresses))};updateStorage=(e,t,n)=>{switch(t){case"full_name":{let t=C(n);this.phones[t]=e;break}case"address":{let t=B(n);this.names[t]=e;break}case"phone":{let t=N(n);this.addresses[t]=e;break}}this.refreshStorage()};isUnique=(e,t)=>{switch(e){case"full_name":return!Boolean(this.names[t]);case"phone":return!Boolean(this.phones[t]);case"address":return!Boolean(this.addresses[t])}};updateNameByPhone=(e,t)=>{this.phones[e]=t};updateAddressByName=(e,t)=>{this.names[e]=t};updatePhoneByAddress=(e,t)=>{this.addresses[e]=t};addNewRecord=(e,t,n)=>{h.updateNameByPhone(t,e),h.updateAddressByName(e,n),h.updatePhoneByAddress(n,t)};deleteData=e=>{delete this.phones[C(e)],delete this.addresses[N(e)],delete this.names[B(e)]}};let u=(e,t)=>{e.setAttribute("class",t)},c=(e,t)=>{e.setAttribute("id",t)},p=(e,t)=>{e.setAttribute("placeholder",t)},g=t=>{i=[];let n=e.getElementsByTagName("tr");for(let e=0;e<n.length;e++){let t=n.item(e);t.removeAttribute("style"),t.removeAttribute("selected")}};n.onclick=e=>{g()},t.onclick=t=>{i=[];let n=[],s=e.getElementsByTagName("tr");for(let e=0;e<s.length;e++){let t=s.item(e);null!==t.getAttribute("selected")&&(n.push(t),h.deleteData(t),h.refreshStorage())}n.forEach(t=>{e.removeChild(t)}),1===s.length&&b()};let f=(e,t)=>{r.removeChild(t),d.style.filter="",a.style.filter=""};s.onclick=e=>{let t=document.createElement("div");u(t,"modal");let n=document.createElement("form"),s=document.createElement("span");u(s,"heading"),s.innerText="Add new info",n.appendChild(s);let l=document.createElement("input");c(l,"full_name"),p(l,"Name"),l.setAttribute("autocomplete","off"),n.appendChild(l),l=document.createElement("input"),c(l,"phone"),l.setAttribute("type","phone"),p(l,"Phone"),l.setAttribute("autocomplete","off"),n.appendChild(l),l=document.createElement("input"),c(l,"address"),p(l,"Address"),l.setAttribute("autocomplete","off"),n.appendChild(l),n.focus(),n.onmouseleave=e=>{f(0,t)};let o=document.createElement("button");o.innerText="Add",o.onclick=e=>((e,t)=>{e.preventDefault();let n=!0,s=t.getElementsByTagName("input"),l={};for(let e=0;e<s.length;e++){let r=s.item(e),a=r.getAttribute("id"),d=r.value,o=document.createElement("span"),i=t.getElementsByTagName("span");if(r.style.borderColor="black",i.length>1&&t.removeChild(i.item(i.length-1)),0===d.length){n=!1,u(o,"error"),o.innerText="Empty field",r.style.borderBottomColor="red",t.appendChild(o);break}if(!h.isUnique(a,d)){n=!1,u(o,"error"),o.innerText=a.charAt(0).toUpperCase()+a.substring(1)+" is not unique",r.style.borderBottomColor="red",t.appendChild(o);break}l[a]=d}n&&(0===h.getItem("addresses").length&&y(),h.addNewRecord(l.full_name,l.phone,l.address),h.refreshStorage(),v({full_name:l.full_name,phone:l.phone,address:l.address}),f(0,t))})(e,t),n.appendChild(o),t.appendChild(n),d.style.transition="0.7s all linear",d.style.filter="blur(10px)",a.style.transition="0.7s all linear",a.style.filter="blur(10px)",r.appendChild(t)};let b=()=>{if(1===o.getElementsByTagName("table").length){o.removeChild(e);let s=document.createElement("div"),l=document.createElement("h2");s.appendChild(l),l.innerText="There`s no info... Add some!",o.appendChild(s),t.setAttribute("disabled",""),n.setAttribute("disabled","")}},y=()=>{0!==o.getElementsByTagName("div").length&&(o.removeChild(o.getElementsByTagName("div").item(0)),o.appendChild(e))},E=t=>e.getElementsByTagName("tr")[parseInt(t)+1],A=(e,t)=>e.getElementsByTagName("td")[t],B=e=>A(e,0).innerText,N=e=>A(e,2).innerText,C=e=>A(e,1).innerText,T=e=>{g();let t=e.target,n=t.getAttribute("vertIndex"),s=t.getAttribute("horIndex"),l=document.createElement("input");l.value=t.innerText,l.onblur=e=>{((e,t,n)=>{let s=e.target,l=E(n),r=A(l,t),a=s.value,d=r.getAttribute("key");a.length>0&&(h.updateStore(a,d,l),r.removeChild(s),r.innerText=a)})(e,s,n)},t.innerText="",t.appendChild(l),l.focus()},v=t=>{let n=document.createElement("tr");n.onclick=e=>{(e=>{let t=e.currentTarget,n=t.getAttribute("selected"),s=t.style,l=t.getElementsByTagName("td")[0].getAttribute("vertIndex");null===n?(s.backgroundColor="#89099c",s.color="white",t.setAttribute("selected",""),i.push(l)):(s.backgroundColor="transparent",s.color="black",t.removeAttribute("selected"),i=i.filter(e=>e!==l))})(e)},Object.keys(t).forEach((e,s)=>{let l=document.createElement("td");l.innerText=t[e],l.setAttribute("horIndex",s),l.setAttribute("vertIndex",m),l.setAttribute("key",e),l.ondblclick=e=>{T(e)},n.appendChild(l)}),e.appendChild(n),m++};l.onclick=t=>{t.preventDefault();let n=e.getElementsByTagName("tr");if(1===n.length)b();else if(n.length>1)for(let t=1;t<n.length;t++)e.removeChild(n.item(t));y(),fetch("https://whatruska.github.io/Bars_Group_Test/app/lpu.json").then(e=>e.json()).then(e=>{e.forEach(e=>{let t=e.address,n=e.phone,s=e.full_name;v(e),h.addNewRecord(s,n,t)}),h.refreshStorage(),window.location.reload()})},(()=>{y();let e=JSON.parse(h.getItem("names"));null===e&&(e={}),h.setNames(e);let t=JSON.parse(h.getItem("phones"));null===t&&(t={}),h.setPhones(t);let n=JSON.parse(h.getItem("addresses"));null===n&&(n={}),h.setAddresses(n);let s=Object.keys(n);for(let e=0;e<s.length;e++){let l=s[e],r=n[l],a=t[r];v({full_name:a,phone:r,address:l})}0!==m&&0!==h.length||b()})()}));